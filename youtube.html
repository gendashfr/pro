<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>YouTube Studio - Channel Analytics</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- React & ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone for JSX execution in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
      body {
        font-family: 'Roboto', sans-serif;
        background-color: #1f1f1f;
        color: #ffffff;
        overflow: hidden; /* Empêche le scroll global du body */
      }
      /* Custom scrollbar hiding */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <!-- Script React Principal -->
    <script type="text/babel" data-presets="env,react">
      const { useState, useMemo, useEffect } = React;

      // ---------------------------------------------------------
      // 1. UTILITAIRES & LOGIQUE DE DONNÉES
      // ---------------------------------------------------------
      const RPM = 3.5; // Revenue per 1000 views
      const WATCH_HOURS_PER_VIEW = 0.06; // ~3.6 minutes
      const SUBS_PER_1000_VIEWS = 2.5;

      const formatDate = (date) => {
        return date.toLocaleDateString('fr-FR', { month: 'short', day: 'numeric', year: 'numeric' });
      };

      const generateHistory = (annualRevenueTarget) => {
        const days = 730; // 2 ans
        const dailyRevenueBase = annualRevenueTarget / 365;
        
        const data = [];
        const today = new Date();
        
        for (let i = 0; i < days; i++) {
          const date = new Date(today);
          date.setDate(today.getDate() - (days - 1 - i));
          
          // Randomness: +/- 40% + saisonnalité week-end
          const randomFactor = 0.6 + Math.random() * 0.8; 
          const dayOfWeek = date.getDay();
          const seasonality = (dayOfWeek === 0 || dayOfWeek === 6) ? 1.2 : 0.9;
          
          const dailyRevenue = dailyRevenueBase * randomFactor * seasonality;
          const dailyViews = (dailyRevenue / RPM) * 1000;
          const dailyWatchTime = dailyViews * WATCH_HOURS_PER_VIEW * (0.8 + Math.random() * 0.4);
          const dailySubs = (dailyViews / 1000) * SUBS_PER_1000_VIEWS * (0.5 + Math.random() * 1.0);

          data.push({
            date: formatDate(date),
            fullDate: date,
            revenue: dailyRevenue,
            views: Math.round(dailyViews),
            watchTimeHours: dailyWatchTime,
            subscribers: Math.round(dailySubs)
          });
        }
        return data;
      };

      const filterDataByRange = (fullHistory, range) => {
        const daysMap = {
          '7d': 7,
          '28d': 28,
          '90d': 90,
          '365d': 365
        };
        
        const days = daysMap[range];
        // On prend les derniers 'days' jours pour la période actuelle
        const currentPeriod = fullHistory.slice(-days);
        // On prend les 'days' jours précédents pour la comparaison
        const previousPeriod = fullHistory.slice(-days * 2, -days);
        
        return { currentPeriod, previousPeriod };
      };

      const formatMetric = (val, type) => {
          if (type === 'revenue') return val.toFixed(2);
          if (val >= 1000000) return (val / 1000000).toFixed(1) + 'M';
          if (val >= 1000) return (val / 1000).toFixed(1) + 'K';
          return Math.round(val).toString();
      };

      // ---------------------------------------------------------
      // 2. COMPOSANTS UI
      // ---------------------------------------------------------

      // --- Chart Component (SVG Interactif) ---
      const Chart = ({ data, dataKey, color }) => {
        const [hoveredIdx, setHoveredIdx] = useState(null);

        const values = useMemo(() => data.map(d => d[dataKey]), [data, dataKey]);
        const maxVal = Math.max(...values, 1);
        const minVal = 0;
        
        const width = 100;
        const height = 100;
        
        const getX = (index) => (index / (data.length - 1)) * width;
        const getY = (value) => height - ((value - minVal) / (maxVal - minVal)) * (height * 0.8) - 10;

        const pathD = useMemo(() => {
          if (data.length === 0) return '';
          let d = `M ${getX(0)} ${getY(values[0])}`;
          for (let i = 1; i < data.length; i++) {
            d += ` L ${getX(i)} ${getY(values[i])}`;
          }
          return d;
        }, [data, values]);

        const handleMouseMove = (e) => {
          const rect = e.currentTarget.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const relativeX = x / rect.width;
          const idx = Math.round(relativeX * (data.length - 1));
          setHoveredIdx(Math.max(0, Math.min(idx, data.length - 1)));
        };

        return (
          <div 
            className="relative w-full h-full"
            onMouseMove={handleMouseMove}
            onMouseLeave={() => setHoveredIdx(null)}
          >
              {/* Y-Axis Labels */}
              <div className="absolute top-0 right-0 h-full flex flex-col justify-between text-[11px] text-[#aaaaaa] font-bold text-right pr-2 py-4 pointer-events-none">
                  <span>{formatMetric(maxVal, dataKey)}</span>
                  <span>{formatMetric(maxVal * 0.5, dataKey)}</span>
                  <span>0</span>
              </div>

              <svg className="w-full h-full overflow-visible" viewBox={`0 0 ${width} ${height}`} preserveAspectRatio="none">
                  {[0, 25, 50, 75, 100].map(h => (
                      <line key={h} x1="0" y1={h} x2="100" y2={h} stroke="rgba(255,255,255,0.05)" strokeWidth="0.2" />
                  ))}
                  <path d={pathD} fill="none" stroke={color} strokeWidth="0.5" strokeLinejoin="round" vectorEffect="non-scaling-stroke" />

                  {hoveredIdx !== null && (
                      <>
                          <line 
                              x1={getX(hoveredIdx)} y1="0" 
                              x2={getX(hoveredIdx)} y2="100" 
                              stroke="rgba(255,255,255,0.2)" 
                              strokeWidth="0.2" 
                              vectorEffect="non-scaling-stroke" 
                          />
                          <circle 
                              cx={getX(hoveredIdx)} 
                              cy={getY(values[hoveredIdx])} 
                              r="1.5" 
                              fill={color} 
                              stroke="#fff" 
                              strokeWidth="0.5" 
                              vectorEffect="non-scaling-stroke"
                          />
                      </>
                  )}
              </svg>

              {/* X-Axis Labels */}
              <div className="flex justify-between mt-2 text-[11px] text-[#aaaaaa] font-medium px-1">
                  {data.length > 0 && [0, 0.25, 0.5, 0.75, 1].map((pct, i) => {
                      const idx = Math.round((data.length - 1) * pct);
                      return <span key={i}>{data[idx]?.date}</span>;
                  })}
              </div>

              {/* Tooltip */}
              {hoveredIdx !== null && data[hoveredIdx] && (
                  <div 
                      className="absolute z-50 bg-[#282828] border border-white/10 rounded-sm shadow-xl p-3 pointer-events-none transform -translate-x-1/2 -translate-y-full mb-2"
                      style={{ 
                          left: `${(hoveredIdx / (data.length - 1)) * 100}%`,
                          top: `${(getY(values[hoveredIdx]) / height) * 100}%`
                      }}
                  >
                      <p className="text-[10px] font-bold text-[#aaaaaa] uppercase mb-1">{data[hoveredIdx].date}</p>
                      <p className="text-sm font-bold text-white whitespace-nowrap">
                          {formatMetric(values[hoveredIdx], dataKey)}
                          {dataKey === 'views' && ' vues'}
                          {dataKey === 'subscribers' && ' abonnés'}
                          {dataKey === 'watchTimeHours' && ' heures'}
                          {dataKey === 'revenue' && ' €'}
                      </p>
                  </div>
              )}
          </div>
        );
      };

      // --- Sidebar Item ---
      const SidebarItem = ({ label, icon, active }) => {
        const icons = {
            dashboard: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>,
            content: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
            analytics: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>,
            comments: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
            subtitles: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="14" x="3" y="5" rx="2"/><path d="M7 10h2M11 10h6M7 14h6M15 14h2"/></svg>,
            copyright: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M14.83 14.83a4 4 0 1 1 0-5.66"/></svg>,
            earn: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 18V6"/></svg>,
            customization: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.21 1.21 0 0 0 1.72 0L21.64 5.36a1.21 1.21 0 0 0 0-1.72Z"/><path d="m14 7 3 3"/></svg>,
            audio: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>,
            settings: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
            feedback: <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 1 1-7.6-12.7 8.19 8.19 0 0 1 4.5 1.2L22 3l-1 8.5Z"/></svg>
        };
        return (
            <div className={`flex items-center px-6 py-2.5 gap-4 cursor-pointer transition-colors ${active ? 'bg-white/10 text-[#ff4e45] border-l-4 border-[#ff4e45] pl-5' : 'text-[#aaaaaa] hover:bg-white/5 border-l-4 border-transparent'}`}>
                <span className="shrink-0">{icons[icon]}</span>
                <span className="truncate text-sm font-medium">{label}</span>
            </div>
        );
      };

      const MetricBox = ({ label, value, sub, active, isPositive, onClick }) => (
          <div 
              onClick={onClick}
              className={`flex-1 border-r border-white/10 p-6 text-center cursor-pointer transition-colors hover:bg-white/5 relative ${active ? 'bg-white/5 after:content-[""] after:absolute after:bottom-0 after:left-0 after:right-0 after:h-[3px] after:bg-[#3ea6ff]' : ''}`}
          >
              <p className="text-[12px] text-[#aaaaaa] font-medium mb-1">{label}</p>
              <div className="flex items-center justify-center gap-2">
                  <span className="text-2xl font-bold">{value}</span>
                  <div className={`w-5 h-5 rounded-full flex items-center justify-center ${isPositive ? 'bg-green-500/20 text-green-500' : 'bg-red-500/20 text-red-500'}`}>
                      {isPositive ? (
                          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="4"><path d="m18 15-6-6-6 6"/></svg>
                      ) : (
                          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="4"><path d="m6 9 6 6 6-6"/></svg>
                      )}
                  </div>
              </div>
              {sub && <p className="text-[11px] text-[#aaaaaa] mt-2">{sub}</p>}
          </div>
      );

      const TopContentItem = ({ title, views, img }) => (
          <div className="flex items-center gap-3 cursor-pointer group">
              <div className="w-12 h-7 bg-[#282828] border border-white/10 overflow-hidden shrink-0">
                  <img src={img} className="w-full h-full object-cover group-hover:scale-110 transition-transform" alt="thumbnail" />
              </div>
              <p className="text-[12px] font-medium flex-1 line-clamp-2 group-hover:text-[#3ea6ff] transition-colors">{title}</p>
              <span className="text-[12px] font-bold text-[#aaaaaa]">{views}</span>
          </div>
      );

      // --- Dashboard Main View ---
      const Dashboard = ({ config, onBack }) => {
          const [timeRange, setTimeRange] = useState('28d');
          const [activeMetric, setActiveMetric] = useState('views');

          // Generate data on mount or config change
          const fullHistory = useMemo(() => generateHistory(config.annualRevenueTarget), [config.annualRevenueTarget]);

          const { currentData, metrics } = useMemo(() => {
              const { currentPeriod, previousPeriod } = filterDataByRange(fullHistory, timeRange);
              
              const sum = (arr, key) => arr.reduce((acc, curr) => acc + curr[key], 0);
              
              return {
                  currentData: currentPeriod,
                  metrics: {
                      views: sum(currentPeriod, 'views'),
                      watchTime: sum(currentPeriod, 'watchTimeHours'),
                      subs: sum(currentPeriod, 'subscribers'),
                      revenue: sum(currentPeriod, 'revenue'),
                      prevViews: sum(previousPeriod, 'views'),
                      prevWatchTime: sum(previousPeriod, 'watchTimeHours'),
                      prevSubs: sum(previousPeriod, 'subscribers'),
                      prevRevenue: sum(previousPeriod, 'revenue')
                  }
              };
          }, [fullHistory, timeRange]);

          // Realtime bars mock
          const realtimeBars = useMemo(() => Array.from({ length: 48 }, () => Math.random() * 100), []);

          const getDiffPercent = (current, prev) => {
              if (prev === 0) return 100;
              return Math.round(((current - prev) / prev) * 100);
          };

          const diffs = {
              views: getDiffPercent(metrics.views, metrics.prevViews),
              watchTime: getDiffPercent(metrics.watchTime, metrics.prevWatchTime),
              subs: getDiffPercent(metrics.subs, metrics.prevSubs),
              revenue: getDiffPercent(metrics.revenue, metrics.prevRevenue),
          };

          const rangeLabel = useMemo(() => {
              if (currentData.length === 0) return '';
              const start = currentData[0].date;
              const end = currentData[currentData.length - 1].date;
              return `${start} – ${end}`;
          }, [currentData]);

          // Determine avatar URL (use uploaded or fallback to DiceBear)
          const avatarUrl = config.avatarUrl || `https://api.dicebear.com/7.x/bottts/svg?seed=${config.channelName}`;

          return (
              <div className="flex h-screen w-full bg-[#1f1f1f] text-white overflow-hidden font-roboto">
                  {/* SIDEBAR */}
                  <aside className="w-[240px] flex flex-col shrink-0 bg-[#1f1f1f] border-r border-white/10">
                      <div className="p-6 flex flex-col items-center gap-2 border-b border-white/10">
                          <div className="relative group cursor-pointer" onClick={onBack}>
                              <div className="w-24 h-24 rounded-full bg-slate-700 overflow-hidden ring-4 ring-white/5">
                                  <img src={avatarUrl} alt="avatar" className="w-full h-full object-cover" />
                              </div>
                              <div className="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center rounded-full transition-opacity">
                                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                              </div>
                          </div>
                          <div className="text-center mt-2">
                              <p className="text-sm font-bold">Votre chaîne</p>
                              <p className="text-[12px] text-[#aaaaaa]">{config.channelName}</p>
                          </div>
                      </div>

                      <nav className="flex-1 overflow-y-auto no-scrollbar py-2">
                          <SidebarItem label="Tableau de bord" icon="dashboard" />
                          <SidebarItem label="Contenu" icon="content" />
                          <SidebarItem label="Données analytiques" icon="analytics" active />
                          <SidebarItem label="Commentaires" icon="comments" />
                          <SidebarItem label="Sous-titres" icon="subtitles" />
                          <SidebarItem label="Droits d'auteur" icon="copyright" />
                          <SidebarItem label="Revenus" icon="earn" />
                          <SidebarItem label="Personnalisation" icon="customization" />
                          <SidebarItem label="Bibliothèque audio" icon="audio" />
                          <div className="border-t border-white/10 my-2"></div>
                          <SidebarItem label="Paramètres" icon="settings" />
                          <SidebarItem label="Envoyer des commentaires" icon="feedback" />
                      </nav>
                  </aside>

                  {/* MAIN CONTENT */}
                  <main className="flex-1 flex flex-col overflow-hidden relative bg-[#1f1f1f]">
                      {/* HEADER */}
                      <header className="h-16 flex items-center justify-between px-6 bg-[#282828] border-b border-white/10 shrink-0 z-20">
                          <div className="flex items-center gap-4 flex-1 max-w-2xl">
                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
                              <div className="flex items-center gap-1">
                                  <svg width="32" height="32" viewBox="0 0 24 24" fill="#ff0000"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                                  <span className="text-xl font-bold italic tracking-tighter">Studio</span>
                              </div>
                              <div className="flex-1 flex items-center bg-[#121212] border border-white/10 rounded px-3 py-1 ml-8">
                                  <svg className="text-[#aaaaaa] mr-3" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                                  <input type="text" placeholder="Rechercher sur votre chaîne" className="bg-transparent text-sm w-full outline-none placeholder-[#aaaaaa] text-white" />
                              </div>
                          </div>
                          <div className="flex items-center gap-6">
                              <div className="flex items-center gap-2 p-1 border border-white/10 rounded cursor-pointer hover:bg-white/5 px-3 py-2">
                                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M10 8l6 4-6 4V8z"/></svg>
                                  <span className="text-xs font-bold uppercase tracking-wide">Créer</span>
                              </div>
                              <div className="flex items-center gap-4 text-[#aaaaaa]">
                                  <div className="w-8 h-8 rounded-full bg-slate-600 overflow-hidden">
                                      <img src={avatarUrl} alt="avatar" className="w-full h-full object-cover" />
                                  </div>
                              </div>
                          </div>
                      </header>

                      <div className="flex-1 flex overflow-hidden">
                          <div className="flex-1 overflow-y-auto no-scrollbar p-8 pb-20">
                              <div className="flex justify-between items-center mb-6">
                                  <h1 className="text-2xl font-bold">Données analytiques de la chaîne</h1>
                                  <div className="flex items-center gap-4">
                                      <button className="text-[#3ea6ff] text-sm font-bold uppercase">Mode avancé</button>
                                      
                                      {/* Time Range Selector */}
                                      <div className="relative group">
                                          <div className="flex items-center bg-[#282828] border border-white/10 px-3 py-1.5 rounded cursor-pointer text-sm hover:bg-white/5 transition-colors">
                                              <span>{rangeLabel}</span>
                                              <svg className="ml-2" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m6 9 6 6 6-6"/></svg>
                                          </div>
                                          <div className="absolute top-full right-0 mt-1 w-48 bg-[#282828] border border-white/10 shadow-xl rounded z-50 hidden group-hover:block">
                                              <div onClick={() => setTimeRange('7d')} className={`px-4 py-3 hover:bg-white/10 cursor-pointer text-sm ${timeRange === '7d' ? 'text-[#3ea6ff]' : ''}`}>7 derniers jours</div>
                                              <div onClick={() => setTimeRange('28d')} className={`px-4 py-3 hover:bg-white/10 cursor-pointer text-sm ${timeRange === '28d' ? 'text-[#3ea6ff]' : ''}`}>28 derniers jours</div>
                                              <div onClick={() => setTimeRange('90d')} className={`px-4 py-3 hover:bg-white/10 cursor-pointer text-sm ${timeRange === '90d' ? 'text-[#3ea6ff]' : ''}`}>90 derniers jours</div>
                                              <div onClick={() => setTimeRange('365d')} className={`px-4 py-3 hover:bg-white/10 cursor-pointer text-sm ${timeRange === '365d' ? 'text-[#3ea6ff]' : ''}`}>365 derniers jours</div>
                                          </div>
                                      </div>
                                  </div>
                              </div>

                              {/* TABS */}
                              <div className="flex border-b border-white/10 mb-8">
                                  {['Aperçu', 'Contenu', 'Audience', 'Revenus', 'Recherche'].map(tab => (
                                      <div key={tab} className={`px-0 py-3 mr-6 text-sm font-medium cursor-pointer relative uppercase tracking-wide ${tab === 'Aperçu' ? 'text-[#3ea6ff]' : 'text-[#aaaaaa] hover:text-[#cccccc]'}`}>
                                          {tab}
                                          {tab === 'Aperçu' && <div className="absolute bottom-0 left-0 right-0 h-[3px] bg-[#3ea6ff]"></div>}
                                      </div>
                                  ))}
                              </div>

                              <div className="text-center mb-8">
                                  <h2 className="text-2xl font-bold">
                                      {timeRange === '7d' && "Cette semaine"}
                                      {timeRange === '28d' && "Ce mois-ci"}
                                      {timeRange === '90d' && "Ces 3 derniers mois"}
                                      {timeRange === '365d' && "Cette année"}
                                      , vos vidéos ont été vues {Math.round(metrics.views).toLocaleString('fr-FR')} fois
                                  </h2>
                              </div>

                              {/* METRICS GRID */}
                              <div className="flex border border-white/10 rounded overflow-hidden mb-12 bg-transparent">
                                  <MetricBox 
                                      label="Vues" 
                                      value={`${(metrics.views / (metrics.views > 1000000 ? 1000000 : 1000)).toFixed(1)}${metrics.views > 1000000 ? 'M' : 'K'}`}
                                      sub={`${Math.abs(diffs.views)}% de ${diffs.views >= 0 ? 'plus' : 'moins'} que la période préc.`}
                                      isPositive={diffs.views >= 0}
                                      active={activeMetric === 'views'}
                                      onClick={() => setActiveMetric('views')}
                                  />
                                  <MetricBox 
                                      label="Durée de visionnage (heures)" 
                                      value={`${(metrics.watchTime / 1000).toFixed(1)}K`} 
                                      sub={`${Math.abs(diffs.watchTime)}% de ${diffs.watchTime >= 0 ? 'plus' : 'moins'} que la période préc.`}
                                      isPositive={diffs.watchTime >= 0}
                                      active={activeMetric === 'watchTimeHours'}
                                      onClick={() => setActiveMetric('watchTimeHours')}
                                  />
                                  <MetricBox 
                                      label="Abonnés" 
                                      value={`+${Math.round(metrics.subs)}`} 
                                      sub={`${Math.abs(diffs.subs)}% de ${diffs.subs >= 0 ? 'plus' : 'moins'} que la période préc.`}
                                      isPositive={diffs.subs >= 0}
                                      active={activeMetric === 'subscribers'}
                                      onClick={() => setActiveMetric('subscribers')}
                                  />
                                  <MetricBox 
                                      label="Revenus estimés" 
                                      value={`${Math.round(metrics.revenue).toLocaleString()} €`} 
                                      sub={`${Math.abs(diffs.revenue)}% de ${diffs.revenue >= 0 ? 'plus' : 'moins'} que la période préc.`}
                                      isPositive={diffs.revenue >= 0}
                                      active={activeMetric === 'revenue'}
                                      onClick={() => setActiveMetric('revenue')}
                                  />
                              </div>

                              {/* MAIN CHART */}
                              <div className="relative h-80 w-full mb-12">
                                  <Chart data={currentData} dataKey={activeMetric} color="#3ea6ff" />
                              </div>

                              <div className="text-[#3ea6ff] text-sm font-bold uppercase cursor-pointer hover:underline inline-block">Voir plus</div>

                              <div className="mt-12 text-center text-sm font-bold text-[#aaaaaa] uppercase tracking-wide">
                                  Vos meilleurs contenus pour cette période
                              </div>
                          </div>

                          {/* RIGHT REALTIME SIDEBAR */}
                          <div className="w-[300px] bg-[#1f1f1f] border-l border-white/10 flex flex-col p-6 overflow-y-auto no-scrollbar shrink-0">
                              <div className="mb-6">
                                  <div className="flex justify-between items-center mb-2">
                                      <h3 className="text-sm font-bold">Temps réel</h3>
                                      <div className="w-2 h-2 rounded-full bg-[#3ea6ff] animate-pulse"></div>
                                  </div>
                                  <p className="text-[12px] text-[#aaaaaa]">Mise à jour en direct</p>
                              </div>

                              <div className="mb-8">
                                  <p className="text-2xl font-bold">{Math.round(metrics.subs * 15 + 10916).toLocaleString()}</p>
                                  <p className="text-[12px] text-[#aaaaaa] uppercase font-bold">Abonnés</p>
                                  <p className="text-[#3ea6ff] text-[12px] font-bold uppercase mt-4 cursor-pointer hover:underline">Voir le nombre d'abonnés en direct</p>
                              </div>

                              <div className="mb-8 border-t border-white/10 pt-6">
                                  <div className="flex justify-between items-end mb-4">
                                      <div>
                                          <p className="text-xl font-bold">{(metrics.views / 15).toFixed(0)}</p>
                                          <p className="text-[12px] text-[#aaaaaa]">Vues · Dernières 48 heures</p>
                                      </div>
                                  </div>
                                  <div className="flex items-end gap-[2px] h-12 w-full">
                                      {realtimeBars.map((h, i) => (
                                          <div key={i} className="flex-1 bg-[#3ea6ff]/60 hover:bg-[#3ea6ff] transition-colors cursor-pointer" style={{ height: `${h}%` }}></div>
                                      ))}
                                  </div>
                                  <div className="flex justify-between text-[10px] text-[#aaaaaa] mt-1">
                                      <span>-48h</span>
                                      <span>Maintenant</span>
                                  </div>
                              </div>

                              <div className="border-t border-white/10 pt-6">
                                  <div className="flex justify-between text-[10px] font-bold text-[#aaaaaa] uppercase mb-4">
                                      <span>Meilleurs contenus</span>
                                      <span>Vues</span>
                                  </div>
                                  <div className="space-y-4">
                                      <TopContentItem 
                                          title="Comment optimiser vos revenus YouTube..." 
                                          views={Math.round(metrics.views * 0.12).toString()} 
                                          img="https://picsum.photos/id/10/80/45" 
                                      />
                                      <TopContentItem 
                                          title="Tutoriel complet React & Tailwind" 
                                          views={Math.round(metrics.views * 0.08).toString()} 
                                          img="https://picsum.photos/id/20/80/45" 
                                      />
                                      <TopContentItem 
                                          title="Analyse de données en temps réel" 
                                          views={Math.round(metrics.views * 0.05).toString()} 
                                          img="https://picsum.photos/id/30/80/45" 
                                      />
                                  </div>
                                  <p className="text-[#3ea6ff] text-[12px] font-bold uppercase mt-6 cursor-pointer hover:underline">Voir plus</p>
                              </div>
                          </div>
                      </div>
                  </main>
              </div>
          );
      };

      // --- Config Screen ---
      const ConfigScreen = ({ onGenerate }) => {
          const [local, setLocal] = useState({
              channelName: 'Ma Super Chaîne',
              annualRevenueTarget: 120000,
              avatarUrl: null
          });

          const handleSubmit = () => {
              if (local.annualRevenueTarget > 0 && local.channelName) {
                  onGenerate(local);
              }
          };

          const handleFileChange = (e) => {
              const file = e.target.files[0];
              if (file) {
                  const reader = new FileReader();
                  reader.onloadend = () => {
                      setLocal(prev => ({ ...prev, avatarUrl: reader.result }));
                  };
                  reader.readAsDataURL(file);
              }
          };

          return (
              <div className="min-h-screen flex items-center justify-center p-6 bg-[#1f1f1f] text-white font-roboto">
                  <div className="w-full max-w-md space-y-8 p-10 bg-[#282828] border border-white/10 rounded-lg shadow-2xl">
                      <div className="flex items-center gap-3 mb-4 justify-center">
                          <svg width="48" height="48" viewBox="0 0 24 24" fill="#ff0000"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>
                      </div>
                      <h1 className="text-2xl font-bold text-center">Configuration du Studio</h1>
                      <p className="text-center text-[#aaaaaa] text-sm mb-6">Entrez vos objectifs pour générer un tableau de bord réaliste.</p>
                      
                      {/* Avatar Upload */}
                      <div className="flex flex-col items-center gap-2 mb-6">
                          <div className="relative w-24 h-24 rounded-full bg-[#121212] border border-[#3e3e3e] overflow-hidden flex items-center justify-center group cursor-pointer hover:border-[#3ea6ff] transition-colors">
                              {local.avatarUrl ? (
                                  <img src={local.avatarUrl} className="w-full h-full object-cover" alt="Avatar preview" />
                              ) : (
                                  <div className="flex flex-col items-center justify-center text-[#aaaaaa] text-xs">
                                      <svg className="mb-1" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                                      <span>Photo</span>
                                  </div>
                              )}
                              <input 
                                  type="file" 
                                  accept="image/*" 
                                  className="absolute inset-0 opacity-0 cursor-pointer z-10"
                                  onChange={handleFileChange}
                              />
                              <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity pointer-events-none">
                                  <svg className="text-white" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                              </div>
                          </div>
                          <span className="text-xs text-[#aaaaaa]">Ajouter une photo de profil (optionnel)</span>
                      </div>

                      <div className="space-y-6">
                          <div className="flex flex-col gap-2">
                              <label className="text-xs text-[#aaaaaa] uppercase font-bold tracking-wider">Nom de la chaîne</label>
                              <input 
                                  className="bg-[#121212] border border-[#3e3e3e] text-white p-3 rounded focus:border-[#3ea6ff] outline-none transition-colors" 
                                  value={local.channelName} 
                                  onChange={e => setLocal({...local, channelName: e.target.value})} 
                              />
                          </div>
                          
                          <div className="flex flex-col gap-2">
                              <label className="text-xs text-[#aaaaaa] uppercase font-bold tracking-wider">Objectif de Revenu Annuel (€)</label>
                              <input 
                                  type="number" 
                                  className="bg-[#121212] border border-[#3e3e3e] text-white p-3 rounded focus:border-[#3ea6ff] outline-none transition-colors" 
                                  value={local.annualRevenueTarget} 
                                  onChange={e => setLocal({...local, annualRevenueTarget: parseFloat(e.target.value) || 0})} 
                              />
                              <p className="text-[11px] text-[#aaaaaa]">Toutes les statistiques (Vues, Abonnés, etc.) seront calculées proportionnellement à ce montant.</p>
                          </div>

                          <button 
                              onClick={handleSubmit} 
                              className="w-full bg-[#3ea6ff] text-[#0f0f0f] py-3 rounded font-bold hover:brightness-110 transition-all uppercase text-sm tracking-wide mt-4"
                          >
                              Accéder au Studio
                          </button>
                      </div>
                  </div>
              </div>
          );
      };

      // --- Main App Controller ---
      const App = () => {
          const [config, setConfig] = useState(null);

          if (!config) {
              return <ConfigScreen onGenerate={setConfig} />;
          }

          return <Dashboard config={config} onBack={() => setConfig(null)} />;
      };

      // ---------------------------------------------------------
      // 3. INITIALISATION REACT
      // ---------------------------------------------------------
      const rootElement = document.getElementById('root');
      const root = ReactDOM.createRoot(rootElement);
      root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>